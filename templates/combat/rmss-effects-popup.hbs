<div id="rmss-effects-popup">
    <div class="rmss-tabs">
        <button class="rmss-tab" data-tab="critical">{{ localize "rmss.combat.critical" }}</button>
        <button class="rmss-tab active" data-tab="resistance">{{ localize "rmss.combat.resistance_roll" }}</button>
    </div>

    <div class="rmss-tab-content" data-tab="critical">
        <h3><img src="{{token.texture.src}}" alt="{{token.name}}" width="50" height="50"> {{ localize "rmss.combat.critical_roll" }}</h3>
        <div class="form-group" style="flex-direction: row; flex-wrap: wrap; gap: 1em;">
            <div style="flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="damage">{{ localize "rmss.combat.damage" }}</label>
                <input class="is-positive" type="hidden" id="damage-base" data-dtype="Number" name="damage-base" value="{{damage}}">
                <input class="is-positive" type="number" id="damage" data-dtype="Number" name="damage" value="{{damage}}">
            </div>

            <div style="flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="damage-mult">{{ localize "rmss.combat.multiplier" }}</label>
                <select id="damage-mult">
                    <option value="1">x1</option>
                    <option value="2">x2</option>
                    <option value="3">x3</option>
                    <option value="4">x4</option>
                    <option value="5">x5</option>
                    <option value="6">x6</option>
                </select>
            </div>

            <div style="flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="severity">{{ localize "rmss.combat.critical_severity" }}</label>
                <select name="severity" id="severity">
                    <option value="null" {{#if (eq severity "null")}}selected{{/if}}>-</option>
                    <option value="A" {{#if (eq severity "A")}}selected{{/if}}>A</option>
                    <option value="B" {{#if (eq severity "B")}}selected{{/if}}>B</option>
                    <option value="C" {{#if (eq severity "C")}}selected{{/if}}>C</option>
                    <option value="D" {{#if (eq severity "D")}}selected{{/if}}>D</option>
                    <option value="E" {{#if (eq severity "E")}}selected{{/if}}>E</option>
                </select>
            </div>

            <div style="flex-direction: row; align-items: center; gap: 0.5em;">
                <label>{{ localize "rmss.combat.critical_type" }}</label>
                <select id="critical-type">
                    {{#each critDict}}
                    <option value="{{@key}}" {{#if (eq @key ../critType)}}selected{{/if}}>{{this}}</option>
                    {{/each}}
                </select>
            </div>

            <div id="critical-subtype-container" style="flex-direction: row; align-items: center; gap: 0.5em; {{#unless criticalHasSubtypes}}display: none;{{/unless}}">
                <label>{{ localize "rmss.combat.critical_subtype" }}</label>
                <select id="critical-subtype">
                    {{#each subcritdict}}
                    <option value="{{@key}}">{{this}}</option>
                    {{/each}}
                </select>
            </div>

            <div style="flex-direction: row; align-items: center; gap: 0.5em;">
                <label>{{ localize "rmss.combat.critical_modifier" }}</label>
                <input type="number" id="modifier" data-dtype="Number" name="modifier" value="{{critModifier}}">
            </div>
        </div>
    </div>

    <div class="rmss-tab-content active" data-tab="resistance">
        <h3><img src="{{token.texture.src}}" alt="{{token.name}}" width="50" height="50"> {{ localize "rmss.combat.resistance_roll" }}</h3>
        <div class="form-group" style="flex-direction: column; gap: 1em;">
            <div style="display: flex; flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="rr-attacker-level" style="min-width: 120px;">{{ localize "rmss.combat.attacker_level" }}</label>
                <input type="number" id="rr-attacker-level" data-dtype="Number" value="1" min="1" style="width: 60px;">
            </div>

            <div style="display: flex; flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="rr-defender-level" style="min-width: 120px;">{{ localize "rmss.combat.defender_level" }}</label>
                <input type="number" id="rr-defender-level" data-dtype="Number" value="{{defenderLevel}}" min="0" style="width: 60px;">
            </div>

            <div style="display: flex; flex-direction: row; align-items: center; gap: 0.5em;">
                <label for="rr-modifier" style="min-width: 120px;">{{ localize "rmss.combat.rr_modifier" }}</label>
                <input type="number" id="rr-modifier" data-dtype="Number" value="0" style="width: 60px;">
            </div>

            <div class="rr-calculated" style="margin-top: 0.5em; padding: 0.5em; background: rgba(0,0,0,0.1); border-radius: 4px;">
                <span>{{ localize "rmss.combat.rr_target" }}: <strong id="rr-target-display">--</strong></span>
            </div>
        </div>
    </div>
</div>
